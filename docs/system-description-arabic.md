# نظام مراقبة الصوامع باستخدام Node.js
## تقرير تقني شامل

---

## نظرة عامة على النظام

نظام مراقبة الصوامع المطور بـ Node.js هو نظام خلفي متقدم لإنترنت الأشياء الصناعي (Industrial IoT) مصمم لمراقبة وتحليل بيانات درجات الحرارة من صوامع الحبوب في الوقت الفعلي. يحل هذا النظام محل النظام القديم المطور بـ Flask (Python) بهيكل أكثر تطوراً وأداءً عالياً مبني باستخدام Node.js و Express.js و MySQL.

يتبع التطبيق مبادئ **العمارة النظيفة (Clean Architecture)** المعروفة أيضاً بنموذج Hexagonal/Onion، مما يضمن فصلاً واضحاً للاهتمامات، وقابلية عالية للصيانة، وقابلية توسع قوية.

---

## الهيكل التقني

يتبع المشروع أربع طبقات رئيسية:

### 1. طبقة المجال (Domain Layer)
تحدد الكيانات الأساسية وكائنات القيم مثل:
- **Silo** (الصومعة)
- **Cable** (الكابل)  
- **Sensor** (المستشعر)
- **Reading** (القراءة)
- **Alert** (التنبيه)

### 2. طبقة البنية التحتية (Infrastructure Layer)
تتعامل مع:
- اتصال قاعدة بيانات MySQL
- المستودعات (Repositories)
- التكوينات (Configurations)
- الوظائف المساعدة (معالجة الأخطاء، تنسيق الاستجابات، تخطيط الألوان)

### 3. طبقة التطبيق (Application Layer)
تنفذ حالات الاستخدام التجارية:
- جلب الصوامع
- قراءة البيانات
- حساب المتوسطات
- إدارة التنبيهات

### 4. طبقة العرض (Presentation Layer)
تدير:
- نقاط النهاية REST API
- المتحكمات (Controllers)
- التوجيه باستخدام Express.js

---

## تصميم قاعدة البيانات

يتضمن مخطط MySQL جداول للصوامع والكابلات والمستشعرات والقراءات والتنبيهات والمنتجات وحسابات المستخدمين. العلاقات مطبعة بشكل صارم لضمان سلامة البيانات:

```
SiloGroup (1:N) → Silo
Silo (1:N) → Cable  
Cable (1:N) → Sensor
Sensor (1:N) → Reading/ReadingRaw
```

---

## ملخص نقاط النهاية (API Endpoints)

### الصحة والحالة
- **GET /health** – التحقق من صحة API وقاعدة البيانات

### إدارة الصوامع
- **GET /api/silos** – عرض جميع الصوامع
- **GET /api/silos/:id** – استرداد تفاصيل صومعة واحدة
- **GET /api/cables/:siloId** – جلب الكابلات التابعة لصومعة

### القراءات والبيانات
- **GET /api/readings/latest/by-silo-id** – إرجاع أحدث القراءات لكل صومعة
- **GET /api/readings/by-sensor** – قراءات حسب المستشعر
- **GET /api/readings/by-cable** – قراءات حسب الكابل
- **GET /api/readings/avg/by-silo-id** – متوسط القراءات عبر الكابلات

### التنبيهات
- **GET /api/alerts/active** – عرض جميع تنبيهات درجة الحرارة النشطة

### المستخدمون والمصادقة
- **POST /api/users/register** – تسجيل مستخدم جديد
- **POST /api/users/login** – تسجيل دخول المستخدم
- **GET /api/users/profile** – عرض ملف المستخدم

### الرسائل النصية
- **POST /api/sms/send** – إرسال رسالة نصية
- **GET /api/sms/history** – تاريخ الرسائل النصية

---

## الأداء والموثوقية

تستفيد نسخة Node.js من async/await وتجميع الاتصالات لتحسين الأداء، مما يوفر أوقات استجابة أسرع للاستعلامات وقابلية توسع أفضل مقارنة بالتنفيذ القديم بـ Python.

### المميزات الرئيسية:
- **الإغلاق الآمن** يضمن تنظيف تجمع MySQL بشكل صحيح
- **هياكل استجابة JSON موحدة** تجعل التكامل سلساً مع عملاء الواجهة الأمامية أو لوحات معلومات SCADA
- **معالجة أخطاء مركزية** مع تسجيل شامل
- **دعم CORS** للتكامل مع التطبيقات الحديثة

---

## الميزات الأساسية

### 1. المراقبة في الوقت الفعلي
- مراقبة مستمرة لدرجات الحرارة
- كشف الانقطاع (-127.0°C كقيم حارسة)
- نظام ألوان مرمز (طبيعي/تحذير/حرج/منقطع)

### 2. الأداء العالي
- عمليات غير متزامنة
- تجميع اتصالات قاعدة البيانات
- استعلامات محسنة

### 3. العمارة النظيفة والمعيارية
- فصل واضح للاهتمامات
- قابلية عالية للاختبار والصيانة
- تصميم قابل للتوسع

### 4. معالجة الأخطاء الموحدة والتسجيل
- نظام تسجيل مركزي
- استجابات خطأ موحدة
- تتبع شامل للأخطاء

### 5. استجابات REST موحدة
- تنسيق JSON ثابت
- رموز حالة HTTP صحيحة
- بيانات وصفية شاملة

### 6. التوافق مع CORS
- دعم كامل للطلبات عبر المصادر
- تكامل سلس مع التطبيقات الحديثة

### 7. إدارة اتصال MySQL الآمنة
- تجميع اتصالات محسن
- إغلاق آمن للاتصالات
- منع تسريب الاتصالات

---

## النشر والبيئة

تم تكوين النظام باستخدام dotenv لمتغيرات البيئة، ويعمل التطبيق افتراضياً على المنفذ 3000 مع بيانات اعتماد قاعدة البيانات المدفوعة بالبيئة.

### متطلبات النشر:
- **Node.js** (الإصدار 14 أو أحدث)
- **MySQL** (الإصدار 8.0 أو أحدث)
- **npm** أو **yarn** لإدارة الحزم

### دعم Docker:
يدعم النظام التحويل إلى حاويات Docker ويمكن نشره بسهولة على البنية التحتية المحلية أو السحابية.

---

## تقدير مستوى الملء

يستخدم النظام تقنيات التعلم الآلي (خوارزمية k-means clustering) لتقدير مستويات الملء في الصوامع بناءً على بيانات درجة الحرارة من المستشعرات المتعددة المستويات.

---

## الخلاصة

يوفر نظام مراقبة الصوامع بـ Node.js بنية تحتية خلفية قوية وحديثة وقابلة للصيانة لإدارة درجة الحرارة الصناعية عبر شبكات الصوامع. يتيح تحليل البيانات في الوقت الفعلي والتنبيه والمراقبة مع مبادئ تصميم نظيفة مناسبة للتطبيقات الصناعية واسعة النطاق.

النظام الجديد يمثل تطوراً كبيراً في الأداء وقابلية التوسع وسهولة الصيانة، مما يجعله الحل الأمثل للمراقبة الصناعية الحديثة.

---

**تاريخ التقرير:** أكتوبر 2024  
**الإصدار:** 2.0  
**المطور:** فريق iDEALCHiP للتطوير
